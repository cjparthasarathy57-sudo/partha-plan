# -------------------------
# Stage 1: Build Frontend
# -------------------------
FROM node:18-alpine AS frontend-build

WORKDIR /app/frontend

# copy frontend files
COPY index.html ./
COPY app.css ./
COPY app.js ./
COPY index.js ./

# optional: if using npm packages, copy package.json
# RUN npm install && npm run build
# for now just copy files into /frontend-dist
RUN mkdir -p /app/frontend-dist && cp -r . /app/frontend-dist

# -------------------------
# Stage 2: Backend + Final
# -------------------------
FROM python:3.11-slim

WORKDIR /app

# Install Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy backend code
COPY app.py .
COPY house_plans_metadata.json .
COPY models ./models

# Copy built frontend
COPY --from=frontend-build /app/frontend-dist ./static

# Expose Flask app on port 5000
EXPOSE 5000

# Run Flask backend
CMD ["python", "app.py"]
